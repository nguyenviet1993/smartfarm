<?php $__env->startSection('head'); ?>
    <link type="text/css" rel="stylesheet" href="css/ui.notify.css"/>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('title'); ?>
    Nhập chi phí hàng tháng
<?php $__env->stopSection(); ?>
<?php $__env->startSection('main_content'); ?>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="widget-box">
                    <div class="widget-title"><span class="icon"> <i class="icon-th"></i> </span>
                        <h5>Nhập chi phí hàng tháng</h5>
                    </div>
                    <div class="widget-content tab-content">
                        <div class="tab-pane active">
                            <div class="tab-pane">
                                <div class="widget-content nopadding" style="border-bottom: none">
                                    <form action="/input-fee" method="get">

                                        <div class="control-group">
                                            <input type="text" class="span5" style="float: left; margin-right: 5px"
                                                   name="key" value="<?php echo $key; ?>" onchange="submit(this.form)"/>
                                            <div class="controls">
                                                <button type="submit" class="btn">Tìm kiếm</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content tab-content">
                        <div class="tab-pane active">
                            <div class="tab-pane">
                                <div class="widget-content nopadding">
                                    <table class="table table-bordered table-striped" id="table_fee">
                                        <thead>
                                        <tr>
                                            <th style="min-width: 200px">Tên chi phí</th>
                                            <th>Số lượng</th>
                                            <th>Giá (VNĐ)</th>
                                            <th style="min-width: 100px">Thành tiền (VNĐ)</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <?php foreach($fee_catalogs as $catalog): ?>
                                            <tr>

                                                <td><?php echo $catalog['catalog_name']; ?></td>
                                                <td>
                                                    <input type="number" class="span10 abc"
                                                           id="AMOUNT_<?php echo $catalog['cat_id']; ?>"
                                                           value="<?php echo @$fees[$catalog['cat_id']]['amount']; ?>"
                                                           onchange="changeValue('<?= $catalog['cat_id']?>')"/>&nbsp; <?php echo $catalog['unit']; ?>

                                                </td>
                                                <td>
                                                    <input type="text" class="span10"
                                                           id="PRICE_<?php echo $catalog['cat_id']; ?>"
                                                           onchange="changeValue('<?= $catalog['cat_id']?>')"
                                                           value="<?php echo number_format(@$fees[$catalog['cat_id']]['price'],0); ?>"
                                                           onkeyup="currency_format('<?= $catalog['cat_id']?>')"
                                                    />
                                                </td>
                                                <td>
                                                    <label class="control-label"
                                                           id="SUMMARY_<?php echo $catalog['cat_id']; ?>"><?php echo number_format(@$fees[$catalog['cat_id']]['sum'],0); ?></label>
                                                </td>
                                            </tr>
                                        <?php endforeach; ?>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td style="text-align: right">Tổng</td>
                                            <td>
                                                <label class="control-label" id="TOTAL"><?php echo number_format($total,0); ?></label>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="content">
        <!--- container to hold notifications, and default templates --->
        <div id="container" style="display:none">
            <div id="default">
                <h1>#{title}</h1>
                <p>#{text}</p>
            </div>
        </div>
    </div>
    <script src="js/jquery/jquery.js" type="text/javascript"></script>
    <script src="js/jquery/jquery-ui.js" type="text/javascript"></script>
    <script src="js/currency-format/jquery.priceformat.js"></script>
    <script>

        function currency_format(cat_id) {
            $('#PRICE_' + cat_id).priceFormat({
                prefix: '',
                thousandsSeparator: ',',
                centsLimit: 0,
                clearOnEmpty: true
            });
        }

        function changeValue(cat_id) {
            var amount = $('#AMOUNT_' + cat_id).val();
            var price = $('#PRICE_' + cat_id).val();
            price = parseFloat(price.replace(/,/g, ''));
            var sum = amount * price;
            var sum_format = sum.formatMoney(0, ',', '.');
            $('#SUMMARY_' + cat_id).html(sum_format);
            var total = 0;

            $('#table_fee > tbody  > tr').each(function () {
                $(this).find("td:gt(0)").each(function () {

                    var value = $(this).find("label").html();
                    if (!isNaN(parseFloat(value))) {
                        var temp = parseFloat(value.replace(/,/g, ''));
                        total += temp;

                    }
                });
            });
            $('#TOTAL').html(numberWithCommas(total));

            var agrs = {
                url: "/input-fee-action",
                type: "get",
                dateType: "text",
                data: {
                    price: price,
                    amount: amount,
                    cat_id: cat_id
                },
                success: function (result) {
//                    create("default", { title:'Thông báo', text:'Thành công!'});
                }
            };

            $.ajax(agrs);

        }

        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        Number.prototype.formatMoney = function (decPlaces, thouSeparator, decSeparator) {
            var n = this,
                decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
                decSeparator = decSeparator == undefined ? "." : decSeparator,
                thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
                sign = n < 0 ? "-" : "",
                i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
                j = (j = i.length) > 3 ? j % 3 : 0;
            return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
        };
    </script>
    <script src="js/jquery.notify.js" type="text/javascript"></script>

    <script type="text/javascript">
        function create(template, vars, opts) {
            return $container.notify("create", template, vars, opts);
        }

        $(function () {
            $container = $("#container").notify();

        });
    </script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('layouts.layout_not_jquery', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>